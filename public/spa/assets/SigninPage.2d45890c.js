import{E as f,B as E,I as P,d as R,f as q,Q as B,e as v}from"./index.46a5a464.js";import{Q as j}from"./QCheckbox.0fc8579b.js";import{cs as S,d as U,cm as F,i as O,cn as k,r as p,C as z,w as A,o as G,aI as M,aQ as T,ae as $,af as u,f as n,bj as c,W as D,al as H,bS as W}from"./index.42545eb5.js";import{Q as J,a as K}from"./QCard.85cc34e3.js";import{u as b,_ as L}from"./auth-store.749e4593.js";import{api as X}from"./axios.d19dfa92.js";import{U as Y}from"./urlPaths.enum.6eeee43a.js";import{I as Z}from"./IsEmail.85a87a97.js";import"./use-dark.56ed68ad.js";import"./focus-manager.02955f48.js";import"./QBadge.99cf8690.js";import"./storeforage.51a9cd86.js";async function ee(d){const e=await X.post(Y.SIGNIN,d,{headers:{Authorization:void 0}});if([200,201].includes(e.status))return e.data.token;throw new Error("Signin failed",{cause:e.data})}class se{static async handle(e){e==null||e.on(f.SIGN_IN,async t=>{try{const r=b();delete t.errors;const a=await ee(t);await r.handleAuthToken(a),S.create({message:"Signin successful",color:"positive"})}catch(r){console.log(r),S.create({message:"Signin failed",color:"negative",icon:"warning",timeout:5e3})}})}}var te=Object.defineProperty,ae=Object.getOwnPropertyDescriptor,x=(d,e,t,r)=>{for(var a=r>1?void 0:r?ae(e,t):e,m=d.length-1,s;m>=0;m--)(s=d[m])&&(a=(r?s(e,t,a):s(a))||a);return r&&a&&te(e,t,a),a};class h extends E{email;password}x([Z({},{message:"Please enter a valid email"})],h.prototype,"email",2);x([P({message:"Password is invalid"})],h.prototype,"password",2);const oe={class:"q-pt-sm q-pl-sm",style:{height:"4rem"}},re={class:"flex flex-center",style:{height:"100vh"}},le={class:"text-center q-mx-auto"},ne={class:"text-center",style:{width:"100%"}},ve=U({__name:"SigninPage",setup(d){const e=F(),t=O("eventBus"),r=b(),{token:a}=k(r);se.handle(t);const m=p(!1),s=z(new h),I=p(),N=p();R(async()=>{var o;return await s.validate(),!!((o=s.errors)!=null&&o.length)});function w(o){var g,_;const l=(g=s.errors)==null?void 0:g.find(C=>C.property===o),i=((_=Object.values((l==null?void 0:l.constraints)||{}))==null?void 0:_.join(" & "))||"";return i===""?!0:i}async function V(){var o;(o=s.errors)!=null&&o.length||(t.emit(f.SIGN_IN,s),await e.replace("/dashboard"))}function Q(){y()}function y(){s.email="",s.password=""}return A(a,o=>{o&&e.push("/")}),G(()=>{y()}),M(()=>{t.off(f.SIGN_IN)}),(o,l)=>(T(),$("div",null,[u("div",oe,[n(L,{color:"light-page"})]),u("div",re,[n(J,{style:D([{width:"30rem",height:"40rem"},{borderColor:`2rem solid ${o.$getColor("accent")}`}]),rounded:""},{default:c(()=>[n(K,null,{default:c(()=>[u("div",le,[n(q,null,{default:c(()=>[H(" Sign in ")]),_:1})]),n(B,{style:{height:"100%",width:"100%"},ref_key:"signinFormRef",ref:I,onSubmit:V,onReset:Q,class:"q-gutter-xl q-pt-xl q-px-l"},{default:c(()=>[n(v,{style:{width:"100%"},filled:"",modelValue:s.email,"onUpdate:modelValue":l[0]||(l[0]=i=>s.email=i),label:"Email",hint:"email","lazy-rules":"",rules:[()=>w("email")]},null,8,["modelValue","rules"]),n(v,{style:{width:"100%"},filled:"",type:m.value?"text":"password",modelValue:s.password,"onUpdate:modelValue":l[1]||(l[1]=i=>s.password=i),label:"Password","lazy-rules":"",rules:[()=>w("password")],ref_key:"emailRef",ref:N},null,8,["type","modelValue","rules"]),n(j,{style:{"margin-top":"-2rem"},modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=i=>m.value=i),label:"Show password"},null,8,["modelValue"]),u("div",ne,[n(W,{style:{width:"100%"},label:"Submit",type:"submit",color:"primary",rounded:""})])]),_:1},512)]),_:1})]),_:1},8,["style"])])]))}});export{ve as default};
