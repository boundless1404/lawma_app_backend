import{E as N,B as P,I as R,d as q,f as k,Q as E,e as S}from"./index.53d7a490.js";import{Q as T}from"./QCheckbox.3061206e.js";import{cs as c,d as U,cm as j,cn as A,r as f,C as B,w as F,o as O,aI as z,aQ as M,ae as $,af as u,f as n,bj as p,W as D,al as G,bS as H}from"./index.e12bd1bb.js";import{Q as W,a as J}from"./QCard.86d96aa4.js";import{u as h,_ as K}from"./auth-store.a39430bb.js";import{api as L}from"./axios.75fdcab1.js";import{U as X}from"./urlPaths.enum.6eeee43a.js";import{I as Y}from"./IsEmail.3f45ee9e.js";import"./use-dark.62d118e9.js";import"./focus-manager.02955f48.js";import"./QBadge.f7fd89d1.js";import"./storeforage.b816bd1a.js";async function b(d){const e=await L.post(X.SIGNIN,d,{headers:{Authorization:void 0}});if([200,201].includes(e.status))return e.data.token;throw new Error("Signin failed",{cause:e.data})}class Z{static async handle(e){e==null||e.on(N.SIGN_IN,async o=>{try{const s=h();delete o.errors;const t=await b(o);await s.handleAuthToken(t),c.create({message:"Signin successful",color:"positive"})}catch(s){console.log(s),c.create({message:"Signin failed",color:"negative",icon:"warning",timeout:5e3})}})}static async signin(e,{onSuccess:o,onError:s}={}){try{const t=h();delete e.errors;const a=await b(e);await t.handleAuthToken(a),await(o==null?void 0:o()),c.create({message:"Signin successful",color:"positive"})}catch(t){s==null||s(t),c.create({message:"Signin failed",color:"negative",icon:"warning",timeout:5e3})}}}var ee=Object.defineProperty,te=Object.getOwnPropertyDescriptor,x=(d,e,o,s)=>{for(var t=s>1?void 0:s?te(e,o):e,a=d.length-1,m;a>=0;a--)(m=d[a])&&(t=(s?m(e,o,t):m(t))||t);return s&&t&&ee(e,o,t),t};class w extends P{email;password}x([Y({},{message:"Please enter a valid email"})],w.prototype,"email",2);x([R({message:"Password is invalid"})],w.prototype,"password",2);const ae={class:"q-pt-sm q-pl-sm",style:{height:"4rem"}},se={class:"flex flex-center",style:{height:"100vh"}},oe={class:"text-center q-mx-auto"},re={class:"text-center",style:{width:"100%"}},ye=U({__name:"SigninPage",setup(d){const e=j(),o=h(),{token:s}=A(o),t=f(!1),a=B(new w),m=f(),V=f();q(async()=>{var r;return await a.validate(),!!((r=a.errors)!=null&&r.length)});function g(r){var v,_;const l=(v=a.errors)==null?void 0:v.find(I=>I.property===r),i=((_=Object.values((l==null?void 0:l.constraints)||{}))==null?void 0:_.join(" & "))||"";return i===""?!0:i}async function Q(){var r;(r=a.errors)!=null&&r.length||await Z.signin(a,{onSuccess:async()=>{await e.replace("/dashboard")}})}function C(){y()}function y(){a.email="",a.password=""}return F(s,r=>{r&&e.push("/")}),O(()=>{y()}),z(()=>{}),(r,l)=>(M(),$("div",null,[u("div",ae,[n(K,{color:"light-page"})]),u("div",se,[n(W,{style:D([{width:"30rem",height:"40rem"},{borderColor:`2rem solid ${r.$getColor("accent")}`}]),rounded:""},{default:p(()=>[n(J,null,{default:p(()=>[u("div",oe,[n(k,null,{default:p(()=>[G(" Sign in ")]),_:1})]),n(E,{style:{height:"100%",width:"100%"},ref_key:"signinFormRef",ref:m,onSubmit:Q,onReset:C,class:"q-gutter-xl q-pt-xl q-px-l"},{default:p(()=>[n(S,{style:{width:"100%"},filled:"",modelValue:a.email,"onUpdate:modelValue":l[0]||(l[0]=i=>a.email=i),label:"Email",hint:"email","lazy-rules":"",rules:[()=>g("email")]},null,8,["modelValue","rules"]),n(S,{style:{width:"100%"},filled:"",type:t.value?"text":"password",modelValue:a.password,"onUpdate:modelValue":l[1]||(l[1]=i=>a.password=i),label:"Password","lazy-rules":"",rules:[()=>g("password")],ref_key:"emailRef",ref:V},null,8,["type","modelValue","rules"]),n(T,{style:{"margin-top":"-2rem"},modelValue:t.value,"onUpdate:modelValue":l[2]||(l[2]=i=>t.value=i),label:"Show password"},null,8,["modelValue"]),u("div",re,[n(H,{style:{width:"100%"},label:"Submit",type:"submit",color:"primary",rounded:""})])]),_:1},512)]),_:1})]),_:1},8,["style"])])]))}});export{ye as default};
